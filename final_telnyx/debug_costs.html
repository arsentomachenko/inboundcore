<!DOCTYPE html>
<html>
<head>
    <title>Debug Cost Display</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .box { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; }
        .success { background: #e8f5e9; color: #2e7d32; }
        .error { background: #ffebee; color: #c62828; }
        .info { background: #e3f2fd; color: #1565c0; }
        h1 { color: #333; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .cost { font-size: 24px; font-weight: bold; color: #f57c00; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîç Cost Display Debug Tool</h1>
    
    <div class="box info">
        <h2>üì° Testing API Connection</h2>
        <button onclick="testAPI()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">
            üß™ Test API Now
        </button>
    </div>
    
    <div id="apiResult" class="box"></div>
    <div id="costDisplay" class="box"></div>
    
    <script>
        async function testAPI() {
            const apiResult = document.getElementById('apiResult');
            const costDisplay = document.getElementById('costDisplay');
            
            apiResult.innerHTML = '<h3>‚è≥ Testing...</h3>';
            costDisplay.innerHTML = '';
            
            try {
                // Test API
                const response = await fetch('http://localhost:3000/api/agent/stats');
                const data = await response.json();
                
                console.log('Full API Response:', data);
                
                // Show API response
                apiResult.className = 'box success';
                apiResult.innerHTML = `
                    <h3>‚úÖ API Response Received</h3>
                    <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
                    <h4>Raw JSON:</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
                // Check costs
                if (data.data && data.data.costs) {
                    const costs = data.data.costs;
                    
                    costDisplay.className = 'box success';
                    costDisplay.innerHTML = `
                        <h3>‚úÖ Cost Data Found!</h3>
                        <div class="cost">Total: $${costs.totalCost.toFixed(2)}</div>
                        <div class="cost">Telnyx: $${costs.telnyxCost.toFixed(2)}</div>
                        <div class="cost">OpenAI: $${costs.openaiCost.toFixed(4)}</div>
                        <div class="cost">Avg/Call: $${costs.avgCostPerCall.toFixed(2)}</div>
                        
                        <h4>Breakdown:</h4>
                        <ul>
                            <li>Call Minutes: $${costs.breakdown.callCost.toFixed(4)}</li>
                            <li>Transcription: $${costs.breakdown.transcriptionCost.toFixed(4)}</li>
                            <li>TTS: $${costs.breakdown.ttsCost.toFixed(4)}</li>
                            <li>Transfers: $${costs.breakdown.transferCost.toFixed(4)}</li>
                            <li>OpenAI: $${costs.breakdown.openaiCost.toFixed(4)}</li>
                        </ul>
                        
                        <h4>üîç Debug Info:</h4>
                        <ul>
                            <li>costs.totalCost type: ${typeof costs.totalCost}</li>
                            <li>costs.totalCost value: ${costs.totalCost}</li>
                            <li>costs.totalCost.toFixed(2): ${costs.totalCost.toFixed(2)}</li>
                            <li>Is NaN? ${isNaN(costs.totalCost)}</li>
                            <li>Is zero? ${costs.totalCost === 0}</li>
                        </ul>
                        
                        <h4>üìä What React should show:</h4>
                        <p>If React's <code>costStats.totalCost</code> = ${costs.totalCost}</p>
                        <p>Then <code>costStats.totalCost.toFixed(2)</code> = <strong>${costs.totalCost.toFixed(2)}</strong></p>
                        <p style="color: red; font-weight: bold;">
                            ${costs.totalCost === 0 ? '‚ö†Ô∏è Value is ZERO - no calls made yet?' : '‚úÖ Value is NOT zero - should display!'}
                        </p>
                    `;
                    
                    // Test what React state would look like
                    const reactState = {
                        totalCost: costs.totalCost || 0,
                        telnyxCost: costs.telnyxCost || 0,
                        openaiCost: costs.openaiCost || 0,
                        avgCostPerCall: costs.avgCostPerCall || 0,
                        breakdown: costs.breakdown || {}
                    };
                    
                    console.log('React State Would Be:', reactState);
                    console.log('Display Value:', `$${reactState.totalCost.toFixed(2)}`);
                    
                } else {
                    costDisplay.className = 'box error';
                    costDisplay.innerHTML = `
                        <h3>‚ùå Cost Data NOT Found</h3>
                        <p>Path checked: <code>data.data.costs</code></p>
                        <h4>What we found:</h4>
                        <ul>
                            <li>data exists? ${!!data}</li>
                            <li>data.data exists? ${!!(data && data.data)}</li>
                            <li>data.data.costs exists? ${!!(data && data.data && data.data.costs)}</li>
                        </ul>
                    `;
                }
                
            } catch (error) {
                apiResult.className = 'box error';
                apiResult.innerHTML = `
                    <h3>‚ùå Error</h3>
                    <p>${error.message}</p>
                    <pre>${error.stack}</pre>
                `;
            }
        }
        
        // Auto-run on load
        window.onload = testAPI;
    </script>
</body>
</html>

